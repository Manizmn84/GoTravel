<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>ฺฏุฒุงุฑุด ูุณุฑูุง ุจู ฺฉุดูุฑูุง</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-slate-900 text-slate-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useState } = React;

    function App() {
      const [routes, setRoutes] = useState([]);
      const [status, setStatus] = useState("loading");

      useEffect(() => {
        fetch("http://localhost:8080/reports/country-routes")
          .then(res => res.json())
          .then(res => {
            const raw = Array.isArray(res)
              ? res
              : Array.isArray(res.data)
              ? res.data
              : [];

            // โ Normalize
            const normalized = raw.map(r => ({
              origin: r.origin_country ?? r.OriginCountry,
              destination: r.destination_country ?? r.DestinationCountry,
              count: r.routes_count ?? r.RoutesCount ?? 0,
              type: r.route_type ?? r.RouteType
            }));

            setRoutes(normalized);
            setStatus("ok");
          })
          .catch(() => setStatus("error"));
      }, []);

      return (
        <div className="min-h-screen p-10">
          <h1 className="text-3xl font-bold text-center mb-10 text-sky-400">
            ๐ ฺฏุฒุงุฑุด ูุณุฑูุง ุจู ฺฉุดูุฑูุง
          </h1>

          {status === "loading" && (
            <p className="text-center text-slate-400">
              ุฏุฑ ุญุงู ุฏุฑุงูุช ุฏุงุฏูโูุง...
            </p>
          )}

          {status === "error" && (
            <p className="text-center text-red-400">
              ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุจุง ุณุฑูุฑ
            </p>
          )}

          {status === "ok" && (
            <div className="overflow-x-auto">
              <table className="w-4/5 mx-auto rounded-xl overflow-hidden shadow-xl">
                <thead className="bg-slate-800">
                  <tr>
                    <th className="p-4">ฺฉุดูุฑ ูุจุฏุฃ</th>
                    <th className="p-4">ฺฉุดูุฑ ููุตุฏ</th>
                    <th className="p-4">ุชุนุฏุงุฏ ูุณุฑ</th>
                    <th className="p-4">ููุน ูุณุฑ</th>
                  </tr>
                </thead>

                <tbody>
                  {routes.length === 0 && (
                    <tr>
                      <td colSpan="4" className="p-4 text-center text-slate-400">
                        ุฏุงุฏูโุง ูุฌูุฏ ูุฏุงุฑุฏ
                      </td>
                    </tr>
                  )}

                  {routes.map((r, i) => (
                    <tr
                      key={i}
                      className="odd:bg-slate-800 even:bg-slate-700 text-center hover:bg-slate-600 transition"
                    >
                      <td className="p-3">{r.origin}</td>
                      <td className="p-3">{r.destination}</td>
                      <td className="p-3 font-bold">{r.count}</td>
                      <td
                        className={`p-3 font-semibold ${
                          r.type === "Domestic"
                            ? "text-green-400"
                            : "text-rose-400"
                        }`}
                      >
                        {r.type === "Domestic" ? "ุฏุงุฎู" : "ุจูโุงูููู"}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      );
    }

    ReactDOM
      .createRoot(document.getElementById("root"))
      .render(<App />);
  </script>
</body>
</html>
